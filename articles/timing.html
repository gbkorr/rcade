<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Frame Timing • rcade</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Frame Timing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rcade</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rcade.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/engine.html">High-Level Engine Structure</a></li>
    <li><a class="dropdown-item" href="../articles/guide.html">Basic Package Usage</a></li>
    <li><a class="dropdown-item" href="../articles/inputs.html">Input Handling</a></li>
    <li><a class="dropdown-item" href="../articles/render.html">Drawing to Console</a></li>
    <li><a class="dropdown-item" href="../articles/rollback.html">Rollback in the rcade Engine</a></li>
    <li><a class="dropdown-item" href="../articles/snake.html">Snake Devlog</a></li>
    <li><a class="dropdown-item" href="../articles/timing.html">Frame Timing</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Frame Timing</h1>
            
      

      <div class="d-none name"><code>timing.Rmd</code></div>
    </div>

    
    
<p>This article describes the intricacies of how the game runs (drawing
an updating) at the desired framerate. This information is interesting
for understanding the package at a deeper level but isn’t important to
know for for playing or making games with the package.</p>
<p>I’ll give warning— timing is particularly hard to wrap one’s head
around (it certainly took me a while!). I think I’ve come up with a good
visual representation but it’s still quite abstract.</p>
<div class="section level2">
<h2 id="motivation">1. Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>One of the big questions when making a gaming device is “How will I
get the frames to happen on time, at the right speed?” Gaming consoles
in the past had to overcome significant challenges to achieve this, but
modern computing systems have some conveniences that make it much
easier.</p>
<p><code>rcade</code> uses a very simple and robust timing system to
ensure that the game runs in realtime at the correct speed, by taking
advantage of <code><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">base::Sys.time()</a></code>’s high precision.</p>
<div class="section level3">
<h3 id="goal">1.1. Goal<a class="anchor" aria-label="anchor" href="#goal"></a>
</h3>
<p>But first: what do we want to do on each frame? What even <em>is</em>
a frame?</p>
<p>Every <code>1/framerate</code> seconds, or 1/60th of a second for a
60fps (frames per second) game, we want to tick the game (iterate its
physics, game logic, etc. for one timestep), and then draw the new game
state.</p>
<p>A <strong>“frame”</strong> can refer to a lot of things here, but I
try to use it precisely:</p>
<ul>
<li><p>I use “frame” to mean “the window of time at which we want to
draw a specific gamestate” or said drawing;</p></li>
<li><p>And a “tick” is the specific gamestate, i.e. the RAM after
updating (ticking) a certain amount of times.</p></li>
</ul>
<p>Drawing a frame should ONLY happen if we’re within the 1/60th window
for it; this ensures that the game always looks like it runs at the same
speed even if the drawing is choppy. If we run out of time to draw on a
frame, we can skip the drawing step, but we want to minimize this.</p>
<p>Meanwhile, ticking doesn’t actually have to happen at a specific time
as long as it lines up with the drawing. All we care about is that the
game is <em>drawn</em> at the correct time, and that it’s on the right
tick for when it’s drawn. Because ticking the game is usually very
quick, we can just tick a bunch to catch up if it ever falls behind the
current drawing window.</p>
</div>
</div>
<div class="section level2">
<h2 id="timing-diagram">2. Timing Diagram<a class="anchor" aria-label="anchor" href="#timing-diagram"></a>
</h2>
<p>We’ll use this diagram to conceptualize the timing system. It’s a
little weird, but it does a good job of representing the way the timing
system works.</p>
<p><img src="timing_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" alt="" width="480"></p>
<p>The vertical bars represent desired frames of the game— when we
<em>want</em> the game to advance and draw a frame. As such, they’re
spaced 1/60th of a second apart from each other (for a 60fps game).</p>
<p>The circle represents, roughly, where the RAM is time-wise relative
to these frames<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Specifically, this is
&lt;code&gt;RAM$time - time.sec()&lt;/code&gt;.&lt;/p&gt;"><sup>1</sup></a>. We want it to be “ahead” (to the right) of
the current frame (white bar), but not too far ahead.</p>
<p><img src="timing_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" alt="" width="480"></p>
<p>As time passes, if we don’t update the RAM, it slowly drifts to the
left until it’s behind the current frame. To keep it ahead, we have to
update it— every update of the RAM moves it one frame ahead.</p>
<p><img src="timing_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="384"></p>
<p>So the obvious thing to do is to just update it every time it falls
behind the current frame, to get it back ahead. That’s basically how the
engine works!</p>
<p><img src="timing_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="288"></p>
</div>
<div class="section level2">
<h2 id="timing-logic">3. Timing Logic<a class="anchor" aria-label="anchor" href="#timing-logic"></a>
</h2>
<p>Now, we also want to draw the game, and to make it feel smooth, we
only want to do this when the game is “at” the current frame— ahead of
the white bar. So the logic for timing the game is:</p>
<pre><code>1.  if within of the current frame, sleep (wait) until the game is just behind the current frame
2.  update the RAM (advance a frame)
3.  if within of the current frame, draw the RAM
4.  repeat</code></pre>
<p>This mirrors the code found in <code><a href="../reference/ram.update.html">ram.update()</a></code>.<br>
Notably, this has the following behavior:</p>
<ul>
<li>the game can never run ahead more than a frame</li>
<li>if the game is behind, it repeatedly updates as fast as possible
until it’s caught up</li>
</ul>
</div>
<div class="section level2">
<h2 id="examples">4. Examples:<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>The following diagrams demonstrate this behavior and the engine’s
response to various scenarios, based purely on the logic defined
above.</p>
<p>Note that updating or drawing the RAM both take a little time, but
the timing logic is robust to it. Even when drawing takes <em>more than
a frame</em> (which can happen at higher game resolutions), the engine
is able to deal with it and still draw on time as frequently as
possible!</p>
<div class="section level3">
<h3 id="standard-loop">4.1 Standard Loop<a class="anchor" aria-label="anchor" href="#standard-loop"></a>
</h3>
<p>This is what the game does most of the time when everything is
working smoothly.</p>
<p><img src="timing_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="192"></p>
</div>
<div class="section level3">
<h3 id="slightly-behind">4.2 Slightly Behind<a class="anchor" aria-label="anchor" href="#slightly-behind"></a>
</h3>
<p>When the RAM is a little behind for whatever reason, it quickly
catches up.</p>
<p><img src="timing_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="192"></p>
</div>
<div class="section level3">
<h3 id="far-behind">4.3 Far Behind<a class="anchor" aria-label="anchor" href="#far-behind"></a>
</h3>
<p>When the RAM is far behind (e.g. right after a rollback; see
<code><a href="../articles/rollback.html">vignette("rollback")</a></code>), it updates as quickly as possible to
catch up.</p>
<p><img src="timing_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="" width="480"></p>
</div>
<div class="section level3">
<h3 id="frame-skipping">4.4 Frame Skipping<a class="anchor" aria-label="anchor" href="#frame-skipping"></a>
</h3>
<p>If drawing the RAM takes more than a frame, the engine organically
skips drawing every other frame (or more) to keep running and drawing in
realtime.</p>
<p><img src="timing_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="192"></p>
</div>
</div>
<div class="section level2">
<h2 id="notes">5. Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<p>Records of salient timings can be found in <code>RAM$debug</code>
(see <code><a href="../reference/ram.debug.html">?ram.debug</a></code>) after running a game:</p>
<ul>
<li><p><code>RAM$debug$ahead</code> corresponds to the x position (in
seconds) of the white circle in these diagrams at the end of every logic
cycle.</p></li>
<li><p><code>RAM$debug$time.draw</code> records the time it takes for
just the draw step, <code>ram.draw()</code>. This can be helpful for
identifying if drawing is the cause of frameskipping, as in the last
example.</p></li>
<li><p><code>RAM$debug$time.tick</code> records the time for just the
tick step, <code><a href="../reference/ram.tick.html">ram.tick()</a></code>. This is usually instant unless your
game runs a physics system with lots of complex interactions or uses the
likes of a chess engine.</p></li>
</ul>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gabriel Broussard Korr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
