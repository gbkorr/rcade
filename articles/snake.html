<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Snake Devlog • rcade</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Snake Devlog">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rcade</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rcade.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/engine.html">High-Level Engine Structure</a></li>
    <li><a class="dropdown-item" href="../articles/guide.html">Basic Package Usage</a></li>
    <li><a class="dropdown-item" href="../articles/inputs.html">Input Handling</a></li>
    <li><a class="dropdown-item" href="../articles/render.html">Drawing to Console</a></li>
    <li><a class="dropdown-item" href="../articles/rollback.html">Rollback in the rcade Engine</a></li>
    <li><a class="dropdown-item" href="../articles/snake.html">Snake Devlog</a></li>
    <li><a class="dropdown-item" href="../articles/timing.html">Frame Timing</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Snake Devlog</h1>
            
      

      <div class="d-none name"><code>snake.Rmd</code></div>
    </div>

    
    
<p>This article goes through the full process of making and testing the
<code>Snake</code> ROM. Snake is a good game to demonstrate the basic
input and gamelogic functionality of the package, and it doesn’t require
fancy graphics; graphical capabilities are explored in
<code>vignette("rcade.super_rrio")</code>.</p>
<div class="section level2">
<h2 id="engine-structure">1. Engine Structure<a class="anchor" aria-label="anchor" href="#engine-structure"></a>
</h2>
<p>A ROM is an object (list) made with <code><a href="../reference/rom.init.html">rom.init()</a></code> that the
package can use to play a game. A ROM contains all the <em>static</em>
data of the game— game logic, sprites, and so on. This is what we’re
building in this article.</p>
<p>Once you have a ROM, you play it by making a RAM object—which stores
all the <em>dynamic</em> data for the game—and running it with
<code><a href="../reference/ram.run.html">ram.run()</a></code>. This runs the game code from the ROM, which
references and writes to variables in the RAM. You’ll see that most of
the game code in this article works with the RAM.</p>
<p><code>vignette("rcade.guide")</code> provides an overview of this
process for playing games, and <code>vignette("rcade.engine")</code>
describes the ROM/RAM in a little more detail.</p>
</div>
<div class="section level2">
<h2 id="setup">2. Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Before we start, we have to make some decisions about how the game
will work.</p>
<ul>
<li>The snake will be controlled with WASD, since R can’t capture arrow
key presses.</li>
<li>The speed of the snake will be determined by the game’s framerate,
since there’s no point to drawing it any faster than that.</li>
<li>We’ll use an arbitrary game area of 16x8 for now, and change it
later.</li>
</ul>
<div class="section level3">
<h3 id="rom-initialization">2.1 ROM Initialization<a class="anchor" aria-label="anchor" href="#rom-initialization"></a>
</h3>
<p>To start, we create the ROM object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span> <span class="op">=</span> <span class="fu"><a href="../reference/rom.init.html">rom.init</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">8</span>,framerate<span class="op">=</span><span class="fl">2</span>,sprites<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pixel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>There’s more we can add with this function (<code><a href="../reference/rom.init.html">rom.init()</a></code>),
but this is all we need for now; we’ll add additional properties to the
object throughout the article.</p>
<p>So far, we’ve:</p>
<ul>
<li>set game area to 16x8</li>
<li>set framerate to 2 frames per second</li>
<li>created a single sprite called “pixel” which is a 1x1 pixel</li>
</ul>
<p>And the game automatically uses the default WASD controls:<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;See &lt;code&gt;&lt;a href="../reference/inputs.process.html"&gt;?inputs.process&lt;/a&gt;&lt;/code&gt; for more info on how
keybinds are set and interpreted.&lt;/p&gt;'><sup>1</sup></a></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Snake$keybinds = c(w = 'up', a = 'left', s = 'down', d = 'right')</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="moving-the-snake">3. Moving the Snake<a class="anchor" aria-label="anchor" href="#moving-the-snake"></a>
</h2>
<p>The first step is to make the snake head object, which is what the
player controls.</p>
<div class="section level3">
<h3 id="initialization">3.1 Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h3>
<p>We’ll initialize this object in <code>Snake$startup</code>, which
runs once when the RAM is initialized. This is where we want to create
objects that will be used later— it’s like the top of a code file.</p>
<div class="callout-note">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">startup</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  </span>
<span>        spritename <span class="op">=</span> <span class="st">'pixel'</span>,</span>
<span>  </span>
<span>        direction <span class="op">=</span> <span class="st">'neutral'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>The snake (<code>head</code> object) starts at the center of the
screen and has the direction ‘neutral’ to indicate it hasn’t started
moving yet.</p>
</div>
<div class="section level3">
<h3 id="control">3.2 Control<a class="anchor" aria-label="anchor" href="#control"></a>
</h3>
<p>We’ll control the snakehead by changing its <code>$direction</code>.
We can do this by checking <code>RAM$actions</code> for player-input
directions, and setting <code>head$direction</code> if a new valid
direction has been input.</p>
<p>We want this code to run every tick in <code>Snake$custom()</code>,
but instead of cluttering that function, we can make a new function and
call it in <code>Snake$custom()</code>. We can’t just define this new
function in the basic R environment— the RAM would have no way to access
it in its environment. So instead we make it a part of the ROM. Then,
the RAM can run it with <code>RAM$ROM$set_direction()</code>, since the
RAM has access to a copy of ROM.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">set_direction</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#name of the actions pressed on this tick, or NULL</span></span>
<span>  <span class="va">actions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">actions</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">actions</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">#print the direction so we know it's working</span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">echo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">actions</span>,collapse <span class="op">=</span> <span class="st">' '</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">#set head direction</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span><span class="op">)</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span> <span class="op">=</span> <span class="va">actions</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="movement">3.3 Movement<a class="anchor" aria-label="anchor" href="#movement"></a>
</h3>
<p>Now we move the head based on its direction.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">move_head</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">head</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span> <span class="co">#for typing convenience</span></span>
<span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">head</span><span class="op">)</span></span>
<span>  <span class="co">#convert direction name to x and y</span></span>
<span>    <span class="va">direction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">'neutral'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'left'</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'right'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'up'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="st">'down'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">[[</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">head</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="va">head</span><span class="op">$</span><span class="va">x</span> <span class="op">+</span> <span class="va">direction</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">head</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="va">head</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="va">direction</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span> <span class="op">=</span> <span class="va">head</span> <span class="co">#push changes</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing">3.4 Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h3>
<p>Putting this all together, we already have a working prototype where
we can control the head!</p>
<p><strong>FULL CODE SO FAR:</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span> <span class="op">=</span> <span class="fu"><a href="../reference/rom.init.html">rom.init</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">8</span>,framerate<span class="op">=</span><span class="fl">2</span>,sprites<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pixel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#define helper functions (see preceding sections)</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">set_direction</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">move_head</span> <span class="op">=</span> <span class="va">function...</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">startup</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        spritename <span class="op">=</span> <span class="st">'pixel'</span>,</span>
<span>        direction <span class="op">=</span> <span class="st">'neutral'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">custom</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">set_direction</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">move_head</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">RAM</span> <span class="op">=</span> <span class="fu"><a href="../reference/ram.init.html">ram.init</a></span><span class="op">(</span><span class="va">Snake</span><span class="op">)</span> <span class="co">#initialize RAM</span></span>
<span><span class="va">RAM</span> <span class="op">=</span> <span class="fu"><a href="../reference/ram.run.html">ram.run</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> <span class="co">#run game with RAM</span></span></code></pre></div>
<p><img src="snake_1.gif"></p>
</div>
</div>
<div class="section level2">
<h2 id="border">4. Border<a class="anchor" aria-label="anchor" href="#border"></a>
</h2>
<p>Next, let’s make a nice border for the game so we know where the play
area ends. We can do this by generating a sprite in
<code>Snake$startup</code>: We want to make the sprite dynamically like
this so that the game can be played at different resolutions— if we
hard-coded a sprite, it wouldn’t always fit!</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">make_border</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#make border sprite</span></span>
<span>  <span class="va">box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span>,<span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span><span class="op">)</span></span>
<span>  <span class="va">box</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">box</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">box</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2</span></span>
<span>  </span>
<span>  <span class="co">#push this sprite to ROM$sprites</span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">sprites</span><span class="op">$</span><span class="va">border</span> <span class="op">=</span> <span class="va">box</span></span>
<span>  </span>
<span>  <span class="co">#make object to display sprite</span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">border</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spritename<span class="op">=</span><span class="st">'border'</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [][][][][][][][][][][][][][][][]</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []            []              []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; [][][][][][][][][][][][][][][][]</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="segments">5. Segments<a class="anchor" aria-label="anchor" href="#segments"></a>
</h2>
<p>Time to add the segments of the snake. There’s a simple trick to
avoid having to keep track of the whole snake at once:</p>
<ol style="list-style-type: decimal">
<li>Every tick, the snake head moves to a new tile.</li>
<li>Spawn a segment on the empty tile the head just left.</li>
<li>Delete the oldest segment to have spawned, unless an apple was eaten
this tick.</li>
</ol>
<p>This produces exactly the behavior we want, since the “tail” of the
snake always corresponds to the oldest segment.</p>
<div class="section level3">
<h3 id="spawn-segment">5.1 Spawn Segment<a class="anchor" aria-label="anchor" href="#spawn-segment"></a>
</h3>
<p>New segments are spawned each frame in <code>Snake$custom</code>
before moving the head:<br>
We use <code><a href="../reference/ram.new_object.html">ram.new_object()</a></code> to add nameless objects to
<code>RAM$objects</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">spawn_segment</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#spawn new tail segment</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="fu"><a href="../reference/ram.new_object.html">ram.new_object</a></span><span class="op">(</span><span class="va">RAM</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">x</span>,</span>
<span>    y <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">y</span>,</span>
<span>  </span>
<span>    <span class="co">#used to find which objects are tail objects</span></span>
<span>    is_segment <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  </span>
<span>    <span class="co">#tick on which this segment spawned</span></span>
<span>    time_created <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ticks</span>, </span>
<span>  </span>
<span>    spritename <span class="op">=</span> <span class="st">'pixel'</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="remove-tail">5.2 Remove Tail<a class="anchor" aria-label="anchor" href="#remove-tail"></a>
</h3>
<p>Then we can loop through the objects, find the oldest segment, and
remove it.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">remove_tail</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">oldest_time</span> <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  <span class="va">oldest_index</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">obj</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">is_segment</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#obj has $is_segment property</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">time_created</span> <span class="op">&lt;</span> <span class="va">oldest_time</span><span class="op">)</span><span class="op">{</span> <span class="co">#object is oldest so far</span></span>
<span>            <span class="va">oldest_time</span> <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">time_created</span></span>
<span>            <span class="va">oldest_index</span> <span class="op">=</span> <span class="va">i</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co">#remove oldest segment</span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[</span><span class="op">-</span><span class="va">oldest_index</span><span class="op">]</span> </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>WARNING: Because of how R handles nested objects,
<code>RAM$objects</code> always has to be iterated by
<code>for (i in 1:length(RAM$objects))</code>. Attempting
<code>for (obj in RAM$objects)</code> will NOT work.</p>
</div>
<div class="section level3">
<h3 id="testing-1">5.3 Testing<a class="anchor" aria-label="anchor" href="#testing-1"></a>
</h3>
<p>To test the segments, we’ll have to make code for the snake to grow.
The snake will grow any time we don’t delete the tail segment, so let’s
prevent that code from running every, say, 5 ticks. Let’s also speed up
the game a little so it’s easier to test.</p>
<p><strong>FULL CODE SO FAR:</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span> <span class="op">=</span> <span class="fu"><a href="../reference/rom.init.html">rom.init</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">8</span>,framerate<span class="op">=</span><span class="fl">5</span>,sprites<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pixel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#helper functions from before</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">set_direction</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">move_head</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">make_border</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">spawn_segment</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">remove_tail</span> <span class="op">=</span> <span class="va">function...</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">startup</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">#make border</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">make_border</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="co">#make head</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        spritename <span class="op">=</span> <span class="st">'pixel'</span>,</span>
<span>        direction <span class="op">=</span> <span class="st">'neutral'</span></span>
<span>    <span class="op">)</span></span>
<span>      </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">custom</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#only do segment stuff once the snake starts moving </span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span> <span class="op">!=</span> <span class="st">'neutral'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">spawn_segment</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co">#skip this every fifth tick to grow the snake</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ticks</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">5</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">remove_tail</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span>  <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">#move snake</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">set_direction</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">move_head</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/quickload.html">quickload</a></span><span class="op">(</span><span class="va">Snake</span><span class="op">)</span></span></code></pre></div>
<p><img src="snake_2.gif"></p>
</div>
<div class="section level3">
<h3 id="quickload">5.4 quickload()<a class="anchor" aria-label="anchor" href="#quickload"></a>
</h3>
<p>As per <code><a href="../articles/engine.html">vignette("engine")</a></code>, the ‘correct’ way of using a
ROM is to initialize the RAM with <code><a href="../reference/ram.init.html">ram.init()</a></code> and then run
it with <code><a href="../reference/ram.run.html">ram.run()</a></code> (as we did in section 3.4). This gets
inconvenient after a while, so I made the wrapper function
<code><a href="../reference/quickload.html">quickload()</a></code> that does both of these automatically. The
manual method is still useful when you need more control over the RAM or
want to rename the RAM object.</p>
<p>All this does is execute those two functions in the environment
<code><a href="../reference/quickload.html">quickload()</a></code> is called in, as if you had typed the two lines
yourself:</p>
<pre><code><span><span class="va">RAM</span> <span class="op">=</span> <span class="fu"><a href="../reference/ram.init.html">ram.init</a></span><span class="op">(</span><span class="va">ROM</span><span class="op">)</span></span>
<span><span class="va">RAM</span> <span class="op">=</span> <span class="fu"><a href="../reference/ram.run.html">ram.run</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="debugging">6. Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h2>
<p>For the sake of demonstration, I’m going to introduce a difficult bug
and walk through the debugging process for it.</p>
<p>Let’s say I had accidentally mistyped a line in
<code>Snake$remove_tail</code> like this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[</span><span class="va">oldest_index</span><span class="op">]</span> </span></code></pre></div>
<p>This accidentally deletes every object except the snake’s tail. But
can we figure that out from the code? Now I get this error message when
the snake starts moving: (see <code><a href="../reference/rom.help.html">?ram.help</a></code> for more details on
this message)</p>
<pre><code>Traceback:
[[1]]
if (!RAM$paused) RAM = ram.tick(RAM)

[[2]]
RAM = RAM$ROM$custom(RAM)

[[3]]
RAM = RAM$ROM$move_head(RAM)

Call:
list(neutral = c(0, 0), left = c(-1, 0), right = c(1, 0), up = c(0, 
    -1), down = c(0, 1))[[head$direction]]

Error:
attempt to select less than one element in get1index</code></pre>
<p>It looks like this list isn’t being keyed properly.</p>
<div class="section level3">
<h3 id="printing">6.1 Printing<a class="anchor" aria-label="anchor" href="#printing"></a>
</h3>
<p>If we put any <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> calls in the game code, we’ll only
see them when the game crashes; normally, they’d be hidden when the
console is wiped every frame. This is very useful for debugging.</p>
<p>As a reminder, if you want something that you <em>can</em> see during
gameplay, the value(s) of <code>RAM$echo</code> are printed below the
game each frame.</p>
<p>So let’s try using this to figure out what’s going on in that list
call. The traceback tells us the error is occurring in
<code>Snake$move_head()</code>, so let’s try adding
<code>print(head$direction)</code> right before the line that
crashes.</p>
<pre><code>NULL
Traceback:
[[1]]...</code></pre>
<p>It printed NULL, so it seems the head doesn’t exist at the moment.
That’s as much info as we’re going to get; this is one of the tougher
bugs<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;It’s a &lt;em&gt;game systems&lt;/em&gt; bug— a mistake that doesn’t
immediately crash the game (unlike a syntax error), but instead changes
the gamestate in a valid but unintended way, which leads to crashes
later on. This is how the majority of game bugs go in any language, and
squashing them is a skill that can take a while to build. I’d say the
two most important parts are:&lt;/p&gt;
&lt;ol style="list-style-type: decimal"&gt;
&lt;li&gt;Having intuition for how these sorts of bugs manifest and work.&lt;/li&gt;
&lt;li&gt;Knowing where to debug (print info) in the code to narrow down the
possible causes.&lt;/li&gt;
&lt;/ol&gt;'><sup>2</sup></a>
that doesn’t tell us exactly where it’s happening.</p>
<p>Knowing that <code>RAM$objects$head</code> is getting deleted
somewhere, the best we can do is look through the code at every line
where we change <code>RAM$objects</code> or
<code>RAM$objects$head</code>. There’s not too many of those at the
moment, so hopefully we notice the incorrect line and can correct
it.</p>
</div>
</div>
<div class="section level2">
<h2 id="game-end">7. Game End<a class="anchor" aria-label="anchor" href="#game-end"></a>
</h2>
<p>With that fixed, back to developing the game.</p>
<p>It’s time to check for when the player loses. This is fairly simple—
we just have to see if the snake head is out of bounds (hit the wall) or
overlapping a segment (hit itself).</p>
<p>We’ll make another function to help check for that overlap. (We’ll
also be reusing this function to see when the Snake touches an
apple!)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#returns true if both objects are at the same coordinates</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">overlap</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj1</span>, <span class="va">obj2</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">obj1</span><span class="op">$</span><span class="va">x</span> <span class="op">==</span> <span class="va">obj2</span><span class="op">$</span><span class="va">x</span> <span class="op">&amp;&amp;</span> <span class="va">obj1</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="va">obj2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can check for collisions like so:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">check_game_end</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">end_game</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    </span>
<span>    <span class="co">#out of bounds</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span></span>
<span>      <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">2</span> <span class="op">||</span></span>
<span>        <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">||</span></span>
<span>        <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;</span> <span class="fl">2</span> <span class="op">||</span></span>
<span>        <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">y</span> <span class="op">&gt;</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="va">end_game</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    </span>
<span>    <span class="co">#check overlap with segment</span></span>
<span>    <span class="co">#using the same loop from Snake$remove_segment to iterate over the segments</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">obj</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">is_segment</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">overlap</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span>, <span class="va">obj</span><span class="op">)</span><span class="op">)</span> <span class="va">end_game</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>            <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">#stop the game when you lose</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">end_game</span><span class="op">)</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">end_game</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">end_game</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Game over!'</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="../reference/ram.end.html">ram.end</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#stops the game</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="apple">8. Apple<a class="anchor" aria-label="anchor" href="#apple"></a>
</h2>
<div class="section level3">
<h3 id="initialization-1">8.1 Initialization<a class="anchor" aria-label="anchor" href="#initialization-1"></a>
</h3>
<p>First we have to make the Apple object in <code>Snake$startup</code>.
All it needs is coordinates and a sprite!</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>, <span class="co">#random location</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span></span>
<span>    spritename <span class="op">=</span> <span class="st">'pixel'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="logic">8.2 Logic<a class="anchor" aria-label="anchor" href="#logic"></a>
</h3>
<p>The game logic for the apple should be this:</p>
<ul>
<li>Spawn the apple somewhere empty.</li>
<li>If the apple is eaten (overlaps the snake head), grow the Snake
(suppress tail removal).</li>
<li>Repeat.</li>
</ul>
<p>We’ll do that like this in <code>Snake$custom</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">overlap</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span>,<span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">eat_apple</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> <span class="co">#eat apple</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">remove_tail</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And now we have to define <code>Snake$eat_apple</code>. All this has
to do is move the apple to a new, unoccupied location.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#moves the apple</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">eat_apple</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">valid</span> <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">#is the apple in a valid location?</span></span>
<span>    </span>
<span>    <span class="co">#loop until the apple is in a valid (unoccupied) location</span></span>
<span>    <span class="kw">while</span> <span class="op">(</span><span class="op">!</span><span class="va">valid</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">valid</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span></span>
<span>        <span class="co">#new random location</span></span>
<span>        <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co">#overlapping anything? check all the segments again</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">obj</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">is_tail</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">overlap</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span>,<span class="va">obj</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> </span>
<span>                    <span class="co">#overlaps something, break out and try again with a new location</span></span>
<span>                    <span class="va">valid</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                    <span class="kw">break</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Later we’ll put in a little code to check if the player has filled
the area and won, since that would hang this <code>while</code>
loop.</p>
</div>
<div class="section level3">
<h3 id="testing-2">8.3 Testing<a class="anchor" aria-label="anchor" href="#testing-2"></a>
</h3>
<p>Now our code looks like this:</p>
<p><strong>FULL CODE SO FAR:</strong></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span> <span class="op">=</span> <span class="fu"><a href="../reference/rom.init.html">rom.init</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">8</span>,framerate<span class="op">=</span><span class="fl">5</span>,sprites<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pixel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#helper functions from before</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">set_direction</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">move_head</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">make_border</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">spawn_segment</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">remove_tail</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">eat_apple</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">check_game_end</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">end_game</span> <span class="op">=</span> <span class="va">function...</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">startup</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">#make border</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">make_border</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="co">#make head</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        spritename <span class="op">=</span> <span class="st">'pixel'</span>,</span>
<span>        direction <span class="op">=</span> <span class="st">'neutral'</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#make apple</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>, <span class="co">#random location</span></span>
<span>            y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>        </span>
<span>            spritename <span class="op">=</span> <span class="st">'pixel'</span></span>
<span>        <span class="op">)</span></span>
<span>      </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">custom</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#only do segment stuff once the snake starts moving </span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span> <span class="op">!=</span> <span class="st">'neutral'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">spawn_segment</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co">#eat apple or remove tail</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">overlap</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span>,<span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">RAM</span><span class="op">$</span><span class="va">echo</span> <span class="op">=</span> <span class="st">'Apple Eaten'</span> <span class="co">#print this so we know it works </span></span>
<span>            <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">eat_apple</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> <span class="co">#eat apple</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">remove_tail</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">#move snake</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">set_direction</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">move_head</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">#check for game end</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">check_game_end</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/quickload.html">quickload</a></span><span class="op">(</span><span class="va">Snake</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="snake_3.gif" alt="Working great!"><div class="figcaption">Working great!</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="polish">9. Polish<a class="anchor" aria-label="anchor" href="#polish"></a>
</h2>
<p>Time for a bunch of cleanup and QoL.</p>
<div class="section level3">
<h3 id="u-turn-prevention">9.1 U-Turn Prevention<a class="anchor" aria-label="anchor" href="#u-turn-prevention"></a>
</h3>
<p>Currently, there’s nothing stopping you from going back in the
direction you just came from, which would make you instantly collide and
lose. We can add a check in <code>Snake$set_direction()</code> to
prevent this:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">set_direction</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#name of the actions pressed on this tick, or NULL</span></span>
<span>  <span class="va">actions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">actions</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">actions</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">#set head direction</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">action</span> <span class="op">=</span> <span class="va">actions</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">action</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="co">#forbidden direction combos</span></span>
<span>                    neutral <span class="op">=</span> <span class="st">''</span>, <span class="co">#can do any direction from neutral</span></span>
<span>                    left <span class="op">=</span> <span class="st">'right'</span>,</span>
<span>                    right <span class="op">=</span> <span class="st">'left'</span>,</span>
<span>                    up <span class="op">=</span> <span class="st">'down'</span>,</span>
<span>                    down <span class="op">=</span> <span class="st">'up'</span></span>
<span>                <span class="op">)</span><span class="op">[</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span><span class="op">]</span></span>
<span>        <span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span> <span class="op">=</span> <span class="va">action</span></span>
<span>        <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>I’ve also gotten rid of the action echo, since we’re confident it
works at this point.</p>
</div>
<div class="section level3">
<h3 id="counting-segments-and-survival">9.2 Counting Segments and Survival<a class="anchor" aria-label="anchor" href="#counting-segments-and-survival"></a>
</h3>
<p>It would be neat to display some stats about the game when it ends,
like how big the snake is and how long you survived for. We can record
the snake length by incrementing a counter, <code>RAM$segments</code>,
in <code>Snake$add_segment()</code>, and decrementing it in
<code>Snake$remove_segment</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">spawn_segment</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">+</span> <span class="fl">1</span> <span class="co">#increment segments</span></span>
<span>    </span>
<span>    <span class="co">#spawn new tail segment</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="fu"><a href="../reference/ram.new_object.html">ram.new_object</a></span><span class="op">(</span><span class="va">RAM</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">y</span>,</span>
<span></span>
<span>        <span class="co">#used to find which objects are tail objects</span></span>
<span>        is_segment <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span></span>
<span>        <span class="co">#tick on which this segment spawned</span></span>
<span>        time_created <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ticks</span>,</span>
<span></span>
<span>        spritename <span class="op">=</span> <span class="st">'pixel'</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">remove_tail</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">-</span> <span class="fl">1</span> <span class="co">#decrement segments</span></span>
<span>    </span>
<span>    <span class="va">oldest_time</span> <span class="op">=</span> <span class="cn">Inf</span></span>
<span>    <span class="va">oldest_index</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">obj</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">is_segment</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#obj has $is_segment property</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">time_created</span> <span class="op">&lt;</span> <span class="va">oldest_time</span><span class="op">)</span><span class="op">{</span> <span class="co">#object is oldest so far</span></span>
<span>                <span class="va">oldest_time</span> <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">time_created</span></span>
<span>                <span class="va">oldest_index</span> <span class="op">=</span> <span class="va">i</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co">#remove oldest segment</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[</span><span class="op">-</span><span class="va">oldest_index</span><span class="op">]</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Similarly, we can track the number of ticks survived by incrementing
a counter every tick once the player starts moving, in
<code>Snake$custom()</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RAM</span><span class="op">$</span><span class="va">ticks_survived</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ticks_survived</span> <span class="op">+</span> <span class="fl">1</span></span></code></pre></div>
<p>We just have to initialize both counters in
<code>Snake$startup()</code> like so:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">RAM</span><span class="op">$</span><span class="va">ticks_survived</span> <span class="op">=</span> <span class="fl">0</span></span></code></pre></div>
<p>And we can add these variables to the Game Over message:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">end_game</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Game over! Size: '</span>, </span>
<span>            <span class="va">RAM</span><span class="op">$</span><span class="va">segments</span>, </span>
<span>            <span class="st">'. Time survived: '</span>, </span>
<span>            <span class="va">RAM</span><span class="op">$</span><span class="va">ticks_survived</span>, </span>
<span>            <span class="st">'.'</span>, </span>
<span>        sep<span class="op">=</span><span class="st">''</span><span class="op">)</span></span>
<span>    </span>
<span>        <span class="fu"><a href="../reference/ram.end.html">ram.end</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#stops the game</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We also want to make a check for when the player has completely
filled the space with the snake, to prevent that while loop from earlier
from hanging. We can do this by adding a check at the beginning of
<code>Snake$eat_apple()</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">eat_apple</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># check for game win</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'You win!'</span><span class="op">)</span></span>
<span>        <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">end_game</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">valid</span> <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">#is the apple in a valid location?</span></span>
<span></span>
<span>    <span class="co">#loop until the apple is in a valid (unoccupied) location</span></span>
<span>    <span class="kw">while</span> <span class="op">(</span><span class="op">!</span><span class="va">valid</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">valid</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span></span>
<span>        <span class="co">#new random location</span></span>
<span>        <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co">#overlapping anything? check all the segments again</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">obj</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">is_tail</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">overlap</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span>,<span class="va">obj</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="co">#overlaps something, break out and try again with a new location</span></span>
<span>                    <span class="va">valid</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                    <span class="kw">break</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This will end the game before the while loop has a chance to
start.</p>
</div>
<div class="section level3">
<h3 id="starting-segments">9.3 Starting Segments<a class="anchor" aria-label="anchor" href="#starting-segments"></a>
</h3>
<p>It’s nice to start with a few segments. We can do this by suppressing
<code>Snake$remove_tail()</code> in <code>Snake$custom()</code> until
the desired amount of segments is reached, which we’ll define with
<code>RAM$starting_segments</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">&gt;</span> <span class="va">RAM</span><span class="op">$</span><span class="va">starting_segments</span><span class="op">)</span> <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">remove_tail</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span></code></pre></div>
<p>And <code>RAM$starting_segments</code> also has to be initialized in
<code>Snake$startup()</code>. I’ve set it to a default of 10 to skip the
boring part of the game.</p>
</div>
<div class="section level3">
<h3 id="difficulty-choice">9.4 Difficulty Choice<a class="anchor" aria-label="anchor" href="#difficulty-choice"></a>
</h3>
<p>Snake is much harder at different speeds and bounding regions— let’s
give the player the choice to define their own.<br>
We can do this by putting <code><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline()</a></code> in
<code>Snake$startup</code>, which will prompt the player during
<code><a href="../reference/ram.init.html">ram.init()</a></code>.</p>
<p>So this function will go in <code>Snake$starup()</code>,
<em>before</em> we generate the border with
<code>Snake$make_border()</code>. It asks the player if they want to
change the settings from the default, and if so, gives them three
prompts to enter custom settings.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">set_difficulty</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">use_defaults</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="st">'Use default game settings? y/n '</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">use_defaults</span> <span class="op">==</span> <span class="st">'n'</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>        <span class="va">desired_framerate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>            <span class="st">"How FAST should the game be? "</span>,</span>
<span>            <span class="st">"Input an integer or leave blank for default."</span>,</span>
<span>            <span class="st">"2: Easy"</span>,</span>
<span>            <span class="st">"5: Default"</span>,</span>
<span>            <span class="st">"10: Hard"</span>,</span>
<span>            <span class="st">''</span></span>
<span>            ,sep<span class="op">=</span><span class="st">'\n'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">desired_width</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>            <span class="st">"How WIDE should the game area be? "</span>,</span>
<span>            <span class="st">"Input an integer or leave blank for default."</span>,</span>
<span>            <span class="st">"Default: 32"</span>,</span>
<span>            <span class="st">''</span></span>
<span>            ,sep<span class="op">=</span><span class="st">'\n'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">desired_height</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>            <span class="st">"How TALL should the game area be? "</span>,</span>
<span>            <span class="st">"Input an integer or leave blank for default."</span>,</span>
<span>            <span class="st">"Default: 16"</span>,</span>
<span>            <span class="st">''</span></span>
<span>            ,sep<span class="op">=</span><span class="st">'\n'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">desired_segments</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>            <span class="st">"How LONG should the snake start at? "</span>,</span>
<span>            <span class="st">"Input an integer or leave blank for default."</span>,</span>
<span>            <span class="st">"Default: 0"</span>,</span>
<span>            <span class="st">''</span></span>
<span>            ,sep<span class="op">=</span><span class="st">'\n'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co">#default if blank or nonnumber</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">desired_framerate</span><span class="op">)</span><span class="op">)</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">framerate</span> <span class="op">=</span> <span class="va">desired_framerate</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">desired_width</span><span class="op">)</span><span class="op">)</span>  <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">=</span> <span class="va">desired_width</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">desired_height</span><span class="op">)</span><span class="op">)</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">=</span> <span class="va">desired_height</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">desired_segments</span><span class="op">)</span><span class="op">)</span> <span class="va">RAM</span><span class="op">$</span><span class="va">starting_segments</span> <span class="op">=</span> <span class="va">desired_segments</span></span>
<span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>I’m also changing the defaults of the final ROM to 32x16 @ 5fps. We
had it smaller before for ease of testing.<br>
For the framerate: 5fps is a nice, mildly challenging pace, 2 gives
plenty of time to think, and 10 is rather intense and breakneck,
especially as the snake gets long.</p>
</div>
</div>
<div class="section level2">
<h2 id="game-demo">10. Game Demo<a class="anchor" aria-label="anchor" href="#game-demo"></a>
</h2>
<p>Here’s the (almost) final code for the <code>Snake</code> ROM, and a
GIF of a complete game session.</p>
<p><strong>FULL CODE SO FAR:</strong></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span> <span class="op">=</span> <span class="fu"><a href="../reference/rom.init.html">rom.init</a></span><span class="op">(</span><span class="fl">32</span>,<span class="fl">16</span>,framerate<span class="op">=</span><span class="fl">5</span>,sprites<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pixel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#helper functions from before</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">set_direction</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">move_head</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">make_border</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">spawn_segment</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">remove_tail</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">eat_apple</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">check_game_end</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">end_game</span> <span class="op">=</span> <span class="va">function...</span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">set_difficulty</span> <span class="op">=</span> <span class="va">function...</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">startup</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">starting_segments</span> <span class="op">=</span> <span class="fl">10</span></span>
<span></span>
<span>    <span class="co">#set difficulty</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">set_difficulty</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">#make border</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">make_border</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">#make head</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        spritename <span class="op">=</span> <span class="st">'pixel'</span>,</span>
<span>        direction <span class="op">=</span> <span class="st">'neutral'</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co">#make apple</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>, <span class="co">#random location</span></span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span></span>
<span>        spritename <span class="op">=</span> <span class="st">'pixel'</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">ticks_survived</span> <span class="op">=</span> <span class="fl">0</span></span>
<span></span>
<span>  <span class="va">RAM</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, direction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Snake</span><span class="op">$</span><span class="va">custom</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#only do segment stuff once the snake starts moving</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span> <span class="op">!=</span> <span class="st">'neutral'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">spawn_segment</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">ticks_survived</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ticks_survived</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span>    <span class="co">#eat apple or remove tail</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">overlap</span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span>,<span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">apple</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">eat_apple</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> <span class="co">#eat apple</span></span>
<span>        <span class="op">}</span> </span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">segments</span> <span class="op">&gt;</span> <span class="va">RAM</span><span class="op">$</span><span class="va">starting_segments</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">remove_tail</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>            <span class="co">#once the starting number of segments has been reached, start removing the tail</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>    <span class="co">#move snake</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">set_direction</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">move_head</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#check for game end</span></span>
<span>  <span class="va">RAM</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="fu">check_game_end</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/quickload.html">quickload</a></span><span class="op">(</span><span class="va">Snake</span><span class="op">)</span></span></code></pre></div>
<p><img src="snake_4.gif"></p>
<p>You can see me:</p>
<ol style="list-style-type: decimal">
<li>create the RAM with <code><a href="../reference/ram.init.html">ram.init()</a></code>
</li>
<li>start running the game with <code><a href="../reference/ram.run.html">ram.run()</a></code>
</li>
<li>pull up the listener session</li>
<li>start recording and inputting inputs with
<code><a href="../reference/inputs.listen.html">inputs.listen()</a></code>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="advanced-data-collection">11. Advanced Data Collection<a class="anchor" aria-label="anchor" href="#advanced-data-collection"></a>
</h2>
<p>In the spirit of R, why not make some pretty graphs? It should be
trivial to record some basic data on each tick and process it when the
game is over.</p>
<p>We’ll initialize the variables in <code>Snake$startup()</code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RAM</span><span class="op">$</span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, direction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And then stick a function to record them in
<code>Snake$custom()</code> once the snake starts moving.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">record_data</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">#position</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">x</span>, <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>, <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="co">#direction</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">direction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">direction</span>, <span class="va">RAM</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">head</span><span class="op">$</span><span class="va">direction</span><span class="op">)</span></span>
<span>    <span class="co">#segments</span></span>
<span>    <span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">segments</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">segments</span>, <span class="va">RAM</span><span class="op">$</span><span class="va">segments</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>And now let’s make some graphs. We’ll call this inside
<code>Snake$end_game()</code>: here’s a demo with a round I played.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Snake</span><span class="op">$</span><span class="va">view_data</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">RAM</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="st">"View graphs? y/n "</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'y'</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">op</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">data</span> <span class="op">=</span> <span class="va">RAM</span><span class="op">$</span><span class="va">data</span></span>
<span>    </span>
<span>    <span class="co">#plot 1: segments over time</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">segments</span>,type<span class="op">=</span><span class="st">'l'</span>,xlab<span class="op">=</span><span class="st">'Time'</span>,ylab<span class="op">=</span><span class="st">'Segments'</span>,main<span class="op">=</span><span class="st">'Snake Length'</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#plot 2: direction frequency</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">direction</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">'Facing Direction'</span>,ylab<span class="op">=</span><span class="st">'Frequency'</span>,main<span class="op">=</span><span class="st">'Favored Directions'</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#plot 3: handedness preference</span></span>
<span>    <span class="va">handedness</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>up<span class="op">=</span><span class="st">'Left'</span>,down<span class="op">=</span><span class="st">'Right'</span><span class="op">)</span>,</span>
<span>        left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>down<span class="op">=</span><span class="st">'Left'</span>,up<span class="op">=</span><span class="st">'Right'</span><span class="op">)</span>,</span>
<span>        up <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left<span class="op">=</span><span class="st">'Left'</span>,right<span class="op">=</span><span class="st">'Right'</span><span class="op">)</span>,</span>
<span>        down <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>right<span class="op">=</span><span class="st">'Left'</span>,left<span class="op">=</span><span class="st">'Right'</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">hand_direction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#handedness direction of each turn (or NA if no turn)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">direction</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="va">hand_direction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">hand_direction</span>,<span class="va">handedness</span><span class="op">[[</span><span class="va">data</span><span class="op">$</span><span class="va">direction</span><span class="op">[</span><span class="va">d</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">direction</span><span class="op">[</span><span class="va">d</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">hand_table</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"direction"</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">direction</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">direction</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>, <span class="st">"turn"</span> <span class="op">=</span> <span class="va">hand_direction</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">hand_table</span><span class="op">)</span><span class="op">)</span>, beside<span class="op">=</span><span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">'Turning Handedness\nPreference'</span>, xlab <span class="op">=</span> <span class="st">'Facing Direction'</span>, ylab <span class="op">=</span> <span class="st">'Frequency'</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">'bottomleft'</span>, title<span class="op">=</span> <span class="st">'\nTurn\nDirection'</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Left'</span>,<span class="st">'Right'</span><span class="op">)</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#plot 4: tile frequency</span></span>
<span>    <span class="va">tile_heatmap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.height</span>,<span class="va">RAM</span><span class="op">$</span><span class="va">ROM</span><span class="op">$</span><span class="va">screen.width</span><span class="op">)</span></span>
<span>    <span class="co">#using x and y position for each tick, get position frequencies</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">tick</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">tile_heatmap</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">tick</span><span class="op">]</span>,<span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">tick</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">tile_heatmap</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">tick</span><span class="op">]</span>,<span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">tick</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">tile_heatmap</span> <span class="op">=</span> <span class="va">tile_heatmap</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tile_heatmap</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tile_heatmap</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co">#clip out the border</span></span>
<span>    <span class="va">tile_heatmap</span> <span class="op">=</span> <span class="va">tile_heatmap</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tile_heatmap</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span> <span class="co">#flip upside-down to match the way the game is drawn</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tile_heatmap</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tile_heatmap</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">tile_heatmap</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span>,xaxt<span class="op">=</span><span class="st">'n'</span>, yaxt<span class="op">=</span><span class="st">'n'</span>, main<span class="op">=</span> <span class="st">'Tile Frequency'</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span> <span class="co">#restore original settings</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="snake_files/figure-html/unnamed-chunk-32-1.png" class="r-plt" alt="" width="576"></p>
<p>I only got to 20 (out of 84 max) segments, so these graphs represent
data for the early stages of the game.</p>
<ul>
<li><p><strong>Plot 1</strong> (“Snake Length”) just shows how many
segments the snake had on each tick. Looks like I ate apples at a pretty
linear pace.</p></li>
<li><p><strong>Plot 2</strong> (“Favored Directions”) shows how
frequently the snake was facing in each direction. I spend about twice
as much time travelling horizontally than vertically; interestingly,
this correlates almost perfectly with the play region being twice as
long as it is tall!</p></li>
<li><p><strong>Plot 3</strong> (“Turning Handedness Preference”) shows
the handedness every time I turned— did I turn to the Left or to the
Right? Sometimes this is surprisingly skewed.</p></li>
<li><p><strong>Plot 4</strong> (“Tile Frequency”) displays a heatmap of
how frequently the snake head was on each tile. Unsurprisingly, it’s
grouped towards the middle; I didn’t get far enough in this game to have
to start hugging the sides.</p></li>
</ul>
<p>It could also be cool to look at apple spawns (and how that
correlates with where the snake moved), but I think this is enough for
now.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gabriel Broussard Korr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
