<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Drawing to Console • rcade</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Drawing to Console">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rcade</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rcade.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/engine.html">High-Level Engine Structure</a></li>
    <li><a class="dropdown-item" href="../articles/guide.html">Basic Package Usage</a></li>
    <li><a class="dropdown-item" href="../articles/inputs.html">Input Handling</a></li>
    <li><a class="dropdown-item" href="../articles/render.html">Drawing to Console</a></li>
    <li><a class="dropdown-item" href="../articles/rollback.html">Rollback in the rcade Engine</a></li>
    <li><a class="dropdown-item" href="../articles/snake.html">Snake Devlog</a></li>
    <li><a class="dropdown-item" href="../articles/timing.html">Frame Timing</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Drawing to Console</h1>
            
      

      <div class="d-none name"><code>render.Rmd</code></div>
    </div>

    
    
<p>NEEDS LOTS OF IMAGES</p>
<p>This article goes over the motivation behind the parts of the
rendering system. It builds up from simple console printing to rendering
animations ingame.</p>
<p>Example usage of the rendering functions can be found in their
documentation, e.g. <code><a href="../reference/render.scene.html">?render.scene</a></code>.</p>
<div class="section level2">
<h2 id="goals">1. Goals<a class="anchor" aria-label="anchor" href="#goals"></a>
</h2>
<p>Game with graphics need a way to display their graphics. rcade is
intended to run live-input games at relatively high fps (frames per
second), so it needs a graphical system capable of redrawing itself at
the desired framerate. Past achieving that, it’s a matter of getting as
high a resolution as feasible.</p>
</div>
<div class="section level2">
<h2 id="console-graphics">2. Console Graphics<a class="anchor" aria-label="anchor" href="#console-graphics"></a>
</h2>
<p>R plotting is far too slow to fulfill our needs. Instead, we turn to
a canonical apporach— rendering via the console. Pixels can be printed
as characters in the appropriate locations, giving a low-resolution but
highly usable medium for rendering images. In fact, RStudio allows you
to zoom out a considerable amount, allowing the console to fit upwards
of 800x600 characters.</p>
<p>A couple issues come up. First, characters are much taller than they
are wide, so we use pairs of characters—usually brackets:
<code>[]</code>—to create square pixels.</p>
<div class="section level3">
<h3 id="pixel-art-in-the-console">2.1 Pixel Art in the Console<a class="anchor" aria-label="anchor" href="#pixel-art-in-the-console"></a>
</h3>
<p>Printing to the console like this is quite simple. Strings like this
are quickly interpreted by users as imagery:</p>
<details><summary><strong>Example</strong>
</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">  []  []</span></span>
<span><span class="st">  []  []</span></span>
<span><span class="st"></span></span>
<span><span class="st">[]      []</span></span>
<span><span class="st">  [][][]</span></span>
<span><span class="st">'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   []  []</span></span>
<span><span class="co">#&gt;   []  []</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; []      []</span></span>
<span><span class="co">#&gt;   [][][]</span></span></code></pre></div>
</details><p>But we run into an issue. Art can be printed to the console, but
there’s no guarantee it shows up in the right position…</p>
<p>Luckily, clearning the console means that the next message will
always show up in the same place— we can just clear the console every
time we draw. RStudio supports this with the escape character
<code>cat('\f')</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Try it! It’s very useful in general R work along with
cat(’), which overwrites the current line (and is how things like
loading bars are animated).&lt;/p&gt;"><sup>1</sup></a>, though R.app unfortunately doesn’t.</p>
<p>Redrawing the canvas with <code>cat</code> works quite well, but
takes long enough to cause flickering at higher resolutions. This is
sadly unavoidable. Games can still be played and enjoyed with this
flickering, however, and it usually does not impact the true
framerate.</p>
</div>
<div class="section level3">
<h3 id="storing-pixel-art">2.2 Storing Pixel Art<a class="anchor" aria-label="anchor" href="#storing-pixel-art"></a>
</h3>
<p>If we want to , we can’t just store everything as strings— it would
be a nightmare to work with because of how clunky strings are to edit.
Instead, we can write a function, <code><a href="../reference/render.matrix.html">render.matrix()</a></code>, to
convert directly from a bitmap matrix to a drawable string:</p>
<details><summary><code>render.matrix</code>
</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">render.matrix</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">M</span>, <span class="va">palette</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'  '</span>, <span class="st">'[]'</span>, <span class="st">'  '</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#we assume the bitmap to be positive integers</span></span>
<span>  </span>
<span>  <span class="co">#attach a line of -1 values on the rightmost column to turn into newlines</span></span>
<span>  <span class="va">M</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="co">#transpose to match the orientation of print(M)</span></span>
<span>  </span>
<span>  <span class="co">#add two to make all values work as vector indices</span></span>
<span>  <span class="va">M</span> <span class="op">=</span> <span class="va">M</span> <span class="op">+</span> <span class="fl">2</span></span>
<span>  </span>
<span>  <span class="co">#convert matrix to vector of strings using its values as indices</span></span>
<span>  <span class="va">str</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'\n'</span>,<span class="va">palette</span><span class="op">)</span><span class="op">[</span><span class="va">M</span><span class="op">]</span></span>
<span>  </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">str</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span> <span class="co">#collapse vector and print</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     []  []    </span></span>
<span><span class="co">#&gt;     []  []    </span></span>
<span><span class="co">#&gt; []          []</span></span>
<span><span class="co">#&gt;   [][][][][]</span></span></code></pre></div>
</details><p><code>palette</code> defines how we convert bitmap values to
character pixels— by default, <code>1</code> encodes filled (black)
pixels and <code>0</code> and <code>2</code> are white. Values of
<code>0</code> are used elsewhere in the rendering system to represent
transparency, but assume a white background here and draw them as
white.</p>
</div>
</div>
<div class="section level2">
<h2 id="sprites">3. Sprites<a class="anchor" aria-label="anchor" href="#sprites"></a>
</h2>
<p>So <code><a href="../reference/render.matrix.html">render.matrix()</a></code> lets us print pixel art to the
console if we have a matrix that encodes it. This package calls such a
matrix a <strong>sprite</strong>.</p>
<details><summary><strong>Example</strong>
</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#A sprite is anything that can be printed by render.matrix():</span></span>
<span><span class="va">sprite</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sprite</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span></span>
<span><span class="co">#&gt; [1,]    0    0    1    0    1    0    0</span></span>
<span><span class="co">#&gt; [2,]    0    0    1    0    1    0    0</span></span>
<span><span class="co">#&gt; [3,]    1    0    0    0    0    0    1</span></span>
<span><span class="co">#&gt; [4,]    0    1    1    1    1    1    0</span></span>
<span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span><span class="va">sprite</span><span class="op">)</span></span>
<span><span class="co">#&gt;     []  []    </span></span>
<span><span class="co">#&gt;     []  []    </span></span>
<span><span class="co">#&gt; []          []</span></span>
<span><span class="co">#&gt;   [][][][][]</span></span></code></pre></div>
</details><p>Typically, the game stores and handles sprites directly (as
matrices), and the game dev is expected to generate them on their own.
The package provides a convenient tool for this:
<code><a href="../reference/render.makesprite.html">render.makesprite()</a></code>.</p>
<div class="section level3">
<h3 id="sprite-creation">3.1 Sprite Creation<a class="anchor" aria-label="anchor" href="#sprite-creation"></a>
</h3>
<p><code><a href="../reference/render.makesprite.html">render.makesprite()</a></code> converts user text to a sprite as
intuitively as possible. The goal of this function is to remove the need
for confusing matrix manipulation, and to follow the principle of
WYSIWYG for maximal convenience: “what you see is what you get”.</p>
<details><summary><strong>Example</strong>`
</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sprite</span> <span class="op">=</span> <span class="fu"><a href="../reference/render.makesprite.html">render.makesprite</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">  OOO</span></span>
<span><span class="st"> O   O</span></span>
<span><span class="st">O     O</span></span>
<span><span class="st">O     O</span></span>
<span><span class="st">O     O</span></span>
<span><span class="st"> O   O</span></span>
<span><span class="st">  OOO</span></span>
<span><span class="st">'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span><span class="va">sprite</span><span class="op">)</span></span>
<span><span class="co">#&gt;     [][][]    </span></span>
<span><span class="co">#&gt;   []      []  </span></span>
<span><span class="co">#&gt; []          []</span></span>
<span><span class="co">#&gt; []          []</span></span>
<span><span class="co">#&gt; []          []</span></span>
<span><span class="co">#&gt;   []      []  </span></span>
<span><span class="co">#&gt;     [][][]</span></span></code></pre></div>
</details><p>The limitation is that character strings will look a bit different
from square pixels, but overall I’ve found the function to be extremely
useful.</p>
<p>Sometimes, it’s easier to create a sprite manually as a matrix. This
is especially useful for geometric or procedural shapes:</p>
<details><summary><strong>Example</strong>
</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">8</span>,<span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">box</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">box</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">box</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></span>
<span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span><span class="va">box</span><span class="op">)</span></span>
<span><span class="co">#&gt; [][][][][][][][][][][][][][][][]</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; []                            []</span></span>
<span><span class="co">#&gt; [][][][][][][][][][][][][][][][]</span></span></code></pre></div>
</details>
</div>
</div>
<div class="section level2">
<h2 id="drawing-multiple-things-at-once">4. Drawing Multiple Things at Once<a class="anchor" aria-label="anchor" href="#drawing-multiple-things-at-once"></a>
</h2>
<p><code><a href="../reference/render.matrix.html">render.matrix()</a></code> lets us render an individual sprite to
the console. The natural next step is to somehow
<strong>combine</strong> sprites so they can be drawn together in one
image.</p>
<p>The general approach to this is to take a big, empty, rectangular
‘background’ sprite, and edit in our sprites:</p>
<details><summary><strong>Example</strong>
</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sprite</span> <span class="op">=</span> <span class="fu"><a href="../reference/render.makesprite.html">render.makesprite</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st"> O O</span></span>
<span><span class="st"> O O</span></span>
<span><span class="st"></span></span>
<span><span class="st">O   O</span></span>
<span><span class="st"> OOO</span></span>
<span><span class="st">'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">background</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span>,<span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#paste in sprites</span></span>
<span><span class="va">background</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="va">sprite</span></span>
<span><span class="va">background</span><span class="op">[</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">5</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="va">sprite</span></span>
<span><span class="va">background</span><span class="op">[</span><span class="fl">7</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">3</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="va">sprite</span></span>
<span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span></span>
<span><span class="co">#&gt;   []  []            </span></span>
<span><span class="co">#&gt;   []  []            </span></span>
<span><span class="co">#&gt;             []  []  </span></span>
<span><span class="co">#&gt; []      []  []  []  </span></span>
<span><span class="co">#&gt;   [][][]            </span></span>
<span><span class="co">#&gt;           []      []</span></span>
<span><span class="co">#&gt;             [][][]  </span></span>
<span><span class="co">#&gt;         []  []      </span></span>
<span><span class="co">#&gt;         []  []      </span></span>
<span><span class="co">#&gt;                     </span></span>
<span><span class="co">#&gt;       []      []    </span></span>
<span><span class="co">#&gt;         [][][]</span></span></code></pre></div>
</details><p>The issue with this is that replacing values directly with
<code>matrix[a:b,c:d]</code> will always overwrite the original value.
We can get around this with code like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">overwrite</span> <span class="op">=</span> <span class="va">sprite</span></span>
<span>  <span class="va">overwrite</span><span class="op">[</span><span class="va">sprite</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="va">matrix</span><span class="op">[</span><span class="va">a</span><span class="op">:</span><span class="va">b</span>,<span class="va">c</span><span class="op">:</span><span class="va">d</span><span class="op">]</span><span class="op">[</span><span class="va">sprite</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> </span>
<span>  <span class="co">#replace values of 0 with the value underneath </span></span>
<span>    </span>
<span>  <span class="va">matrix</span><span class="op">[</span><span class="va">a</span><span class="op">:</span><span class="va">b</span>,<span class="va">c</span><span class="op">:</span><span class="va">d</span><span class="op">]</span> <span class="op">=</span> <span class="va">overwrite</span></span></code></pre></div>
<details><summary><strong>Example</strong>
</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">circle</span> <span class="op">=</span> <span class="fu"><a href="../reference/render.makesprite.html">render.makesprite</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">  OOO</span></span>
<span><span class="st"> O   O</span></span>
<span><span class="st">O     O</span></span>
<span><span class="st">O     O</span></span>
<span><span class="st">O     O</span></span>
<span><span class="st"> O   O</span></span>
<span><span class="st">  OOO</span></span>
<span><span class="st">'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">background</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">9</span>,<span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">background</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span> <span class="op">=</span> <span class="va">circle</span></span>
<span></span>
<span><span class="va">overwrite</span> <span class="op">=</span> <span class="va">circle</span></span>
<span><span class="va">overwrite</span><span class="op">[</span><span class="va">circle</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="va">background</span><span class="op">[</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">[</span><span class="va">circle</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> </span>
<span><span class="va">background</span><span class="op">[</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span> <span class="op">=</span> <span class="va">overwrite</span></span>
<span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span></span>
<span><span class="co">#&gt;     [][][]        </span></span>
<span><span class="co">#&gt;   []    [][][]    </span></span>
<span><span class="co">#&gt; []    []    [][]  </span></span>
<span><span class="co">#&gt; []  []      []  []</span></span>
<span><span class="co">#&gt; []  []      []  []</span></span>
<span><span class="co">#&gt;   [][]    []    []</span></span>
<span><span class="co">#&gt;     [][][]    []  </span></span>
<span><span class="co">#&gt;         [][][]    </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</details><p>This whole process is automated by <code><a href="../reference/render.overlay.html">render.overlay()</a></code>,
which also clips the sprite to ensure that everything is kept within the
bounds of the matrix.</p>
<details><summary><strong>Example</strong>
</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">background</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">9</span>,<span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">background</span> <span class="op">=</span> <span class="fu"><a href="../reference/render.overlay.html">render.overlay</a></span><span class="op">(</span><span class="va">background</span>, <span class="va">circle</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">background</span> <span class="op">=</span> <span class="fu"><a href="../reference/render.overlay.html">render.overlay</a></span><span class="op">(</span><span class="va">background</span>, <span class="va">circle</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">background</span> <span class="op">=</span> <span class="fu"><a href="../reference/render.overlay.html">render.overlay</a></span><span class="op">(</span><span class="va">background</span>, <span class="va">circle</span>, <span class="fl">11</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span></span>
<span><span class="co">#&gt;     [][][]              [][]</span></span>
<span><span class="co">#&gt;   []      []          []    </span></span>
<span><span class="co">#&gt; []      [][][]      []      </span></span>
<span><span class="co">#&gt; []    []    [][]    []      </span></span>
<span><span class="co">#&gt; []  []      []  []  []      </span></span>
<span><span class="co">#&gt;   [][]    []    []    []    </span></span>
<span><span class="co">#&gt;     [][][]      []      [][]</span></span>
<span><span class="co">#&gt;       []      []            </span></span>
<span><span class="co">#&gt;         [][][]</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="layers-and-the-scene">5. Layers and the Scene<a class="anchor" aria-label="anchor" href="#layers-and-the-scene"></a>
</h2>
<p>Now that we can combine sprites, we run into the issue of convenient
<strong>ordering</strong>. Which sprites should be drawn on top, and how
do we achieve that?</p>
<p>rcade addresses this with <code><a href="../reference/render.scene.html">render.scene()</a></code>. We create a
‘scene’ object containing <strong>layers</strong>, each of which is
their own <code>background</code> from the previous section. The engine
draws sprites onto specific layers, and then finally takes all the
layers and overlays them one-by-one to produce the final matrix to be
drawn.</p>
<p>[would like an image of this: sprites -&gt; layer (like stickers),
then layers stacked like paper]</p>
<p>To draw a sprite onto a layer, we use <code><a href="../reference/render.sprite.html">render.sprite()</a></code>,
which is really just a wrapper for <code><a href="../reference/render.overlay.html">render.overlay()</a></code> to work
on a layer.</p>
<div class="section level3">
<h3 id="the-inversion-layer">5.1 The Inversion Layer<a class="anchor" aria-label="anchor" href="#the-inversion-layer"></a>
</h3>
<p>In monochrome displays, you’ll sometimes run into the issue where
something important, like text, is drawn over a black background and
becomes impossible to see. A simple fix is to, rather than drawing the
text as set color, just allow it to invert the color it’s drawn on— that
way it’ll always be visible<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Unless you draw it on a patterned surface. In that case,
an opaque outline (like a highlighter or shadow) is needed to make the
text pop.&lt;/p&gt;"><sup>2</sup></a>.</p>
<p>rcade implements this with a dedicated <code>scene</code> layer
called <code>scene$layers$invert</code>, which is drawn last and inverts
anything it covers. This uses the <code>invert</code> argument of
<code><a href="../reference/render.overlay.html">render.overlay()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="drawing-the-ram">6. Drawing the RAM<a class="anchor" aria-label="anchor" href="#drawing-the-ram"></a>
</h2>
<p>The game rendering process involves drawing every game object onto
one scene. This is automated by <code><a href="../reference/render.ram.html">render.ram()</a></code>, which is
called every frame— see <code><a href="../articles/timing.html">vignette("timing")</a></code>.</p>
<p>In this function, a <code>scene</code> object is created, and then
each game object (in <code>RAM$objects</code>) is drawn to it with
<code><a href="../reference/render.sprite.html">render.sprite()</a></code>.</p>
<div class="section level3">
<h3 id="sprites-in-rom">6.1 Sprites in ROM<a class="anchor" aria-label="anchor" href="#sprites-in-rom"></a>
</h3>
<p>By convention, sprites/images are stored in ROM when possible.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This is because if we had a particularly large image
file, as images tend to be nowadays, it would be expensive to store and
copy constantly in RAM. The same was true back in the day; graphics have
always taken up a large portion of most games’ filesize.&lt;/p&gt;"><sup>3</sup></a> They are
stored by name in <code>ROM$sprites</code>, and referenced during the
rendering process.</p>
</div>
<div class="section level3">
<h3 id="object-drawing-specifics">6.2 Object Drawing Specifics<a class="anchor" aria-label="anchor" href="#object-drawing-specifics"></a>
</h3>
<p>Object drawing is handled by <code><a href="../reference/render.object.html">render.object()</a></code>, which
figures out how and where to draw the object with
<code><a href="../reference/render.sprite.html">render.sprite()</a></code>.</p>
<p>Objects are only drawn if they have a <code>$spritename</code>, which
indicates which sprite they use. This is a character string
corresponding to a sprite matrix in <code>ROM$sprites</code>— then
<code><a href="../reference/render.object.html">render.object()</a></code> retrieves the sprite from
<code>ROM$sprites</code> and feeds it into
<code><a href="../reference/render.sprite.html">render.sprite()</a></code>.</p>
<p>Objects have quite a few optional properties, listed in
<code><a href="../reference/render.object.html">?render.object</a></code>. These control things like position and
whether or not this particular object should swap around the colors in
its sprite. ‘palette swapping’ of the colors like this is an easy way to
increase the variety of images in a game without needing to make new
sprites.</p>
</div>
<div class="section level3">
<h3 id="custom-drawing-code">6.3 Custom Drawing Code<a class="anchor" aria-label="anchor" href="#custom-drawing-code"></a>
</h3>
<p>It is often useful to override this basic drawing behavior— for
example, if an object’s sprite should be generated procedurally rather
than copying from a static sprite in <code>ROM$sprites</code>. This can
be done by defining <code>obj$draw()</code>, which will run instead of
the regular code in <code><a href="../reference/render.object.html">render.object()</a></code>.</p>
<p>Note that <code>obj$draw()</code> should return the
<code>scene</code>, and thus must not include any code that changes
values in the object itself; those changes should occur in game code in
<code>ROM$custom()</code> (see <code><a href="../articles/engine.html">vignette("engine")</a></code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="animations">7. Animations<a class="anchor" aria-label="anchor" href="#animations"></a>
</h2>
<p>Now to the topic of animations. If we have a game object change its
sprite every few frames, it will ………….</p>
<p>[VIDEO EXAMPLE]</p>
<p>This is achieved by calling <code><a href="../reference/render.animate.html">render.animate()</a></code> when we
retrieve an object’s sprite in <code><a href="../reference/render.object.html">render.object()</a></code>. For sprites
we want to animate, instead of storing just the pixel art matrix, we
store a list containing each frame of animation and some other
information about the animation. <code><a href="../reference/render.animate.html">render.animate()</a></code> then
parses these to figure out what frame of animation it should return.</p>
<p>We can also specify whether an animation should loop or transition to
a different sprite after completing.</p>
<p><a href="">NEED VIDEO EXAMPLE OF THIS</a></p>
<p>So for the game dev, all that’s needed to animate a sprite is to
store it as a complex sprite in <code>ROM$sprites</code>. Very
convenient! Sprite animations can also be tested with
<code>render.test_animation</code> to ensure they look as they
should.</p>
</div>
<div class="section level2">
<h2 id="text">8. Text<a class="anchor" aria-label="anchor" href="#text"></a>
</h2>
<p>Now for the topic of rendering a piece of text ingame. We could just
<code><a href="../reference/render.sprite.html">render.sprite()</a></code> each character individually, but this is
needlessly ineffecient; instead, the best solution is to combine all the
characters into one sprite and render that in a single
<code><a href="../reference/render.sprite.html">render.sprite()</a></code> call. This is the purpose of
<code><a href="../reference/render.text.html">render.text()</a></code>.</p>
<div class="section level3">
<h3 id="fonts">8.1 Fonts<a class="anchor" aria-label="anchor" href="#fonts"></a>
</h3>
<p>But first, how should store the sprites for each character? rcade
handles these pretty simply— it has <em>font</em> objects which contain
some information about the size/spacing of the characters, and also
contain a list of sprites for each character.
<code><a href="../reference/render.makefont.html">?render.makefont</a></code> provides more detail on this, and
inspecting <code>View(fonts.3x3)</code> may be useful as well.</p>
</div>
<div class="section level3">
<h3 id="render-text">8.2 render.text()<a class="anchor" aria-label="anchor" href="#render-text"></a>
</h3>
<p>The basic functionality of <code><a href="../reference/render.text.html">render.text()</a></code> is stitching
together character sprites with the desired (or default) spacing. It
outputs a sprite, to put in <code>ROM$sprites</code> or draw on the fly
in <code>obj$draw()</code>. Putting text on the inversion layer (with
<code>render.sprite(...layer = 'invert')</code> may be helpful to ensure
that the text is readable on both black or white backgrounds.</p>
<p>Additionally, some code is included to provide the option to wrap
words to fit in a given width of pixels, and align them to the
left/right/center.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Though this code could use some improvement. It does its
job but isn’t very robust— I figured it was already too niche to warrant
more attention.&lt;/p&gt;"><sup>4</sup></a></p>
<p>Here’s an example of <code><a href="../reference/render.text.html">render.text()</a></code>’s stitching:</p>
<details><summary><strong>Example</strong>
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#manually stitching letters with a 1-wide gap between</span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    <span class="va">fonts.3x3</span><span class="op">$</span><span class="va">sprites</span><span class="op">$</span><span class="cn">T</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="va">fonts.3x3</span><span class="op">$</span><span class="va">sprites</span><span class="op">$</span><span class="va">E</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="va">fonts.3x3</span><span class="op">$</span><span class="va">sprites</span><span class="op">$</span><span class="va">X</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="va">fonts.3x3</span><span class="op">$</span><span class="va">sprites</span><span class="op">$</span><span class="cn">T</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [][][]  [][][]  []  []  [][][]</span></span>
<span><span class="co">#&gt;   []    [][]      []      []  </span></span>
<span><span class="co">#&gt;   []    [][][]  []  []    []</span></span>
<span></span>
<span><span class="co">#render.text() does this automatically</span></span>
<span><span class="fu"><a href="../reference/render.matrix.html">render.matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/render.text.html">render.text</a></span><span class="op">(</span><span class="st">'text'</span>, kerning <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                                 </span></span>
<span><span class="co">#&gt; [][][]  [][][]  []  []  [][][]  </span></span>
<span><span class="co">#&gt;   []    [][]      []      []    </span></span>
<span><span class="co">#&gt;   []    [][][]  []  []    []    </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</details><p><code><a href="../reference/render.text.html">?render.text</a></code> provides some more examples of its
capabilities.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gabriel Broussard Korr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
